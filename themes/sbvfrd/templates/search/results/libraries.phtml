<?php

/** @var    \Swissbib\RecordDriver\SolrMarc $driver */
$institutions = $driver->getInstitutions(true);
$institutions = $this->filterUntranslatedInstitutions($institutions, true);

if (sizeof($institutions) > 1) {
  $institutions = $this->institutionSorter()->sortInstitutions($institutions, true);
}

?>
<?php if (count($institutions) > 0): ?>
  <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownLibraries">
    <?php $availabilities = []; ?>
    <?php foreach ($institutions as $institution): ?>
      <?php
        $institutionCode = $institution['institution'];
        $groupCode = $institution['group'];
        $anchor = 'holding-institution-' . $groupCode . '-' . $institutionCode;
      ?>
      <li role="presentation">
        <a role="menuitem" href="<?= $this->recordLink()->getUrl($driver) ?>?expandlib=<?= $groupCode ?>-<?= $institutionCode ?>#<?= $anchor ?>">
           <!-- ?php
           if (!array_key_exists($institutionCode, $availabilities)) $availabilities = $driver->getAvailabilityIcon($institutionCode);
           if (array_key_exists($institutionCode, $availabilities)) {
                $symbolId = $availabilities[$institutionCode];
                switch ($symbolId) {
                    case '0': $availabilityIcon = 'fa-check'; break;
                    case '1': $availabilityIcon = 'fa-ban'; break;
                    case '2': $availabilityIcon = 'fa-question'; break;
                    case '?': $availabilityIcon = 'fa-question'; break;
                    default: $availabilityIcon = 'fa-exclamation-circle'; break;
                }
            } else $availabilityIcon = 'fa-question';
           ?-->
            <span class="a-before"></span>
            <!-- span name="<?php //echo $institutionCode; ?>" class="availability <?php //echo $availabilityIcon; ?>"></span -->
            <?= $this->escapeHtml($this->zendTranslate($institutionCode, 'institution')); ?>
        </a>
      </li>
    <?php endforeach; ?>
  </ul>
<?php endif; ?>