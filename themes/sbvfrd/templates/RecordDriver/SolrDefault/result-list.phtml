<?php
/** @var    Swissbib\RecordDriver\SolrMarc $record */
/** @var    Swissbib\View\Helper\Record $viewRecord */
$record = $this->driver;
$viewRecord = $this->record($this->driver);

$thumbnail = $viewRecord->getThumbnail('small');
$detailLink = $this->recordLink()->getUrl($record);
$titleStatement = $record->getTitleStatement(true);
$shortTitle = $record->getShortTitle();
$subtitle = $viewRecord->getSubtitle($titleStatement);
$responsible = $viewRecord->getResponsible($titleStatement, $record);
$edition = $record->getEdition();
$summDate= $record->getHumanReadablePublicationDates();
$hostItems = $record->getHostItemEntry();
$journalTitle = $record->getContainerTitle();
$groupID = $record->getGroup(true);
$uniqueID = $record->getUniqueID();
$showFRBR = $this->configAccess()->Site->displayFrbr;
$memorizeLink = $this->recordLink()->getActionUrl($this->driver, 'Save');
$formats = $viewRecord->getFormatList();

?>
<div class="<?=$this->driver->supportsAjaxStatus()?'ajaxItem ':''?>col-xs-11 gutter-1">
  <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
  <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getResourceSource())?>" class="hiddenSource" />

  <div class="hidden-xs col-sm-2 col-md-2 no-gutter hidden-print">
    <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="img-responsive">
        <img alt="<?= $this->escapeHtml($shortTitle) ?>" class="recordcover" src="<?= $thumbnail ?>"/>
    </a>
  </div>

  <div class="col-xs-10 col-sm-6 col-md-7">

    <!-- Kurztitel -->
    <div class="item-info">

      <div class="row">
        <div class="col-md-12">
            <h4>
                <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title singleLinkForBulk" title="<?= $this->escapeHtml($shortTitle) ?>">
                    <?= $this->escapeHtml($shortTitle) ?>
                </a>
            </h4>
        </div>
      </div>

        <!-- Untertitel und Verfasserangabe -->
        <div class="row">
           <? if (isset($subtitle)): ?>
            <!--span id="subtitle">< ?= $this->escapeHtml($subtitle) ?></span><br /-->
           <? endif; ?>
            <? if ($responsible): ?>
                <div class="col-md-3 hidden-xs"><?= $this->transEsc('Author') ?>:</div>
                <div class="col-md-9">
                   <?= $this->escapeHtml($responsible) ?>
                </div>
            <? endif; ?>
        </div>

        <!-- Zeitschriftentitel, Erscheinungsjahr HU-->
        <div class="row">
            <? if ($hostItems): ?>
                <? foreach ($hostItems as $hostItem): ?>
                    <? if (array_key_exists('title', $hostItem)): ?>
                        <div class="col-md-3 hidden-xs"><?= $this->transEsc('note_773') ?>:</div>
                        <div class="col-md-9">
                            <? $text = array_key_exists('related', $hostItem) ? $hostItem['title'] . ', ' . $hostItem['related'] : $hostItem['title'] ?>
                            <?= $this->escapeHtml($text) ?>
                        </div>
                    <? endif; ?>
                <? endforeach; ?>
            <? endif; ?>
        </div>
        <div class="row">
            <? if ($journalTitle): ?>
                <div class="col-md-3 hidden-xs"><?= $this->transEsc('Published in')?>:</div>
                <div class="col-md-9"><a href="<?= $viewRecord->getLink('journaltitle', $journalTitle)?>"><?= $this->escapeHtml($journalTitle)?></a></div>
            <? endif; ?>
        </div>
        <div class="row">
            <? if ($summDate): ?>
                    <div class="col-md-3 hidden-xs"><?= $this->transEsc('Year') ?>:</div>
                    <div class="col-md-9"><?= $this->escapeHtml($summDate[0]) ?></div>
            <? endif; ?>
        </div>
        <div class="row">
            <? if ($edition): ?>
                <div class="col-md-3 hidden-xs"><?= $this->transEsc('Edition') ?>:</div>
                <div class="col-md-9"><?= $this->escapeHtml($edition) ?></div>
            <? endif; ?>
        </div>

        <!-- ID -->
        <div class="row visible-print-block">
          <? if ($uniqueID): ?>
                <div class="col-md-3 hidden-xs"><?= $this->transEsc('Item_ID') ?>:</div>
                <div class="col-md-9"><?= $uniqueID ?></div>
          <? endif; ?>
        </div>

        <!-- Medien-Typ -->
        <div class="row">
          <? if (!empty($formats)): ?>
                <div class="col-md-3 hidden-xs"><?= $this->transEsc('Format') ?>:</div>
                <div class="col-md-9"><?= $formats ?></div>
          <? endif; ?>
        </div>

      </div>
    </div>

  <div class="col-xs-1 col-md-3 actions">
    <div>
        <? if ($this->driver->displayHoldings()): ?>
            <?= $this->render('search/results/available.phtml') ?>
            <?= $this->render('search/results/libraries.phtml') ?>
        <? elseif ($this->driver->displayLinks()): ?>
            <?= $this->render('search/results/links.phtml') ?>
        <? endif; ?>

      <? if (!empty($showFRBR) && $showFRBR && !empty($groupID) && !strcmp($results->getParams()->getSearchHandler(), 'FRBR') == 0) : ?>
        <a class="btn btn-primary btn-frbr hidden-print" href="<?= $this->url('search-results') .
            '?lookfor=' . $groupID .
            '&type=FRBR' .
            '&originalSort=' . $results->getParams()->getSort() .
            '&limit=' . $results->getParams()->getLimit() .
            '&sort=publishDateSort+desc' ?>"
           title="<?= $this->transEsc('Other Editions') ?>">
          <span><i class="fa fa-eye"></i></span>
          <span class="hidden-xs hidden-sm"><?= $this->transEsc('Other Editions') ?></span>
        </a>
      <? endif; ?>

      <? if ($this->userlist()->getMode() !== 'disabled'): ?>
        <a class="btn btn-primary hidden-print" href="<?= $this->recordLink()->getActionUrl($this->driver, 'Save'); ?>" title="<?= $this->transEsc('Add to favorites') ?>">
          <span class="memorizelistadd"><i class="fa fa-list-ul"></i></span>
          <span class="hidden-xs hidden-sm"><?= $this->transEsc('List') ?></span>
        </a>
            <? /* Saved lists */ ?>
            <div class="savedLists alert alert-info hidden hidden-xs hidden-sm hidden-print">
                <strong><?=$this->transEsc('Saved in')?>:</strong>
            </div>
      <? endif; ?>

    </div>
  </div>
    <!-- COINS -->
    <span class="Z3988 hidden-print" title="<?= $this->escapeHtml($record->getOpenURL()) ?>"></span>
</div>